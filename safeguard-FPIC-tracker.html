<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Safeguard+FPIC Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .modal { display: none; position: fixed; inset: 0; background: rgba(15, 23, 42, 0.7); z-index: 200; align-items: center; justify-content: center; backdrop-filter: blur(4px); padding: 1rem; }
        .modal.active { display: flex; }
        .form-input { width: 100%; padding: 0.875rem; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 0.75rem; font-size: 0.875rem; transition: all 0.2s; }
        .form-input:focus { outline: none; border-color: #10b981; box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1); background: white; }
        .nav-active { background: #10b981; color: white; box-shadow: 0 10px 15px -3px rgba(16, 185, 129, 0.2); }
        .status-pill { font-size: 0.65rem; font-weight: 800; text-transform: uppercase; padding: 0.25rem 0.75rem; border-radius: 9999px; border-width: 1px; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 h-screen overflow-hidden">

    <div class="flex h-screen">
        <!-- Sidebar -->
        <aside class="hidden lg:flex flex-col w-72 bg-white border-r border-slate-200 p-6">
            <div class="flex items-center space-x-3 mb-10">
                <div class="bg-emerald-600 p-2 rounded-xl shadow-lg"><i class="fas fa-leaf text-white text-xl"></i></div>
                <div>
                    <h1 class="text-xl font-black text-slate-800 tracking-tighter">Safeguard+</h1>
                    <p class="text-[9px] font-bold text-slate-400 uppercase tracking-widest">UNIDO ESIA TOOLKIT</p>
                </div>
            </div>
            
            <nav class="space-y-2 flex-1">
                <button onclick="switchTab('profile')" id="btn-profile" class="nav-active flex items-center space-x-3 w-full p-4 rounded-2xl transition-all">
                    <i class="fas fa-map-marked-alt w-5"></i><span class="font-bold">Site Profile</span>
                </button>
                <button onclick="switchTab('sessions')" id="btn-sessions" class="flex items-center space-x-3 w-full p-4 rounded-2xl text-slate-500 hover:bg-slate-50 transition-all">
                    <i class="fas fa-users-rectangle w-5"></i><span class="font-bold">Engagement Logs</span>
                </button>
                <button onclick="switchTab('dashboard')" id="btn-dashboard" class="flex items-center space-x-3 w-full p-4 rounded-2xl text-slate-500 hover:bg-slate-50 transition-all">
                    <i class="fas fa-chart-line w-5"></i><span class="font-bold">Consent Matrix</span>
                </button>
            </nav>

            <div class="pt-6 border-t border-slate-100">
                <div class="bg-slate-900 text-white p-4 rounded-2xl">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-[10px] font-bold text-slate-400">SYNC STATUS</span>
                        <div class="h-2 w-2 rounded-full bg-emerald-500 animate-pulse"></div>
                    </div>
                    <p class="text-xs font-medium">Local DB Encrypted</p>
                    <button onclick="simulateSync()" class="mt-3 w-full py-2 bg-emerald-600 rounded-lg text-xs font-bold hover:bg-emerald-500 transition-colors">PUSH TO CLOUD</button>
                </div>
            </div>
        </aside>

        <!-- Main Workspace -->
        <main class="flex-1 overflow-y-auto custom-scrollbar">
            <!-- Mobile Bar -->
            <div class="lg:hidden bg-white border-b p-4 flex justify-between items-center">
                <h1 class="font-black text-emerald-600">Safeguard+</h1>
                <i class="fas fa-bars text-slate-500"></i>
            </div>

            <div class="max-w-6xl mx-auto p-6 md:p-12">
                
                <!-- SECTION: PROFILE -->
                <section id="tab-profile" class="tab-content active space-y-8">
                    <div class="flex justify-between items-start">
                        <div>
                            <h2 class="text-4xl font-black text-slate-900 tracking-tight">Site Baseline</h2>
                            <p class="text-slate-500 mt-2 font-medium">Define project boundaries and IP demographics.</p>
                        </div>
                        <button onclick="openModal('modal-profile')" class="bg-white border border-slate-200 px-5 py-2.5 rounded-xl font-bold text-sm hover:shadow-md transition-all">
                            <i class="fas fa-pen-to-square mr-2 text-emerald-600"></i>Setup Site
                        </button>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div class="bg-white p-6 rounded-3xl border border-slate-200 shadow-sm">
                            <span class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Region</span>
                            <p class="text-lg font-bold text-slate-800 mt-1" id="val-region">-</p>
                        </div>
                        <div class="bg-white p-6 rounded-3xl border border-slate-200 shadow-sm">
                            <span class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Barangay</span>
                            <p class="text-lg font-bold text-slate-800 mt-1" id="val-barangay">-</p>
                        </div>
                        <div class="bg-white p-6 rounded-3xl border border-slate-200 shadow-sm">
                            <span class="text-[10px] font-black text-slate-400 uppercase tracking-widest">IP Group</span>
                            <p class="text-lg font-bold text-slate-800 mt-1" id="val-ip">-</p>
                        </div>
                        <div class="bg-white p-6 rounded-3xl border border-slate-200 shadow-sm">
                            <span class="text-[10px] font-black text-slate-400 uppercase tracking-widest">CADT Reference</span>
                            <p class="text-lg font-bold text-slate-800 mt-1" id="val-cadt">-</p>
                        </div>
                    </div>

                    <div class="bg-white rounded-3xl border border-slate-200 overflow-hidden shadow-sm">
                        <div class="p-8 border-b border-slate-50">
                            <h3 class="font-bold text-slate-800 flex items-center">
                                <i class="fas fa-location-crosshairs mr-3 text-emerald-500"></i>Geospatial Verification
                            </h3>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 p-8">
                            <div class="space-y-4">
                                <p class="text-sm text-slate-500 leading-relaxed">ESIA standards require precise GPS logging for all consultation sites in Regions 10, 11, and 12.</p>
                                <div class="bg-slate-50 p-4 rounded-2xl flex items-center justify-between">
                                    <span class="font-mono text-xs font-bold text-slate-400" id="val-coords">0.0000°N, 0.0000°E</span>
                                    <button onclick="getGPS()" class="text-emerald-600 font-black text-[10px] uppercase">Ping GPS</button>
                                </div>
                            </div>
                            <div class="bg-slate-100 rounded-2xl h-40 flex items-center justify-center border-2 border-dashed border-slate-200">
                                <i class="fas fa-map text-slate-300 text-4xl"></i>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- SECTION: SESSIONS -->
                <section id="tab-sessions" class="tab-content space-y-8">
                    <div class="flex justify-between items-end">
                        <div>
                            <h2 class="text-4xl font-black text-slate-900 tracking-tight">Engagement Logs</h2>
                            <p class="text-slate-500 mt-2 font-medium italic">Requirement: Annex 8 - Stakeholder Consultation Records</p>
                        </div>
                        <button onclick="openModal('modal-session')" class="bg-emerald-600 text-white px-6 py-3 rounded-2xl font-bold shadow-lg shadow-emerald-100 hover:scale-105 transition-all">
                            <i class="fas fa-plus mr-2"></i>New Assembly
                        </button>
                    </div>

                    <div id="session-grid" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Rendered via JS -->
                    </div>
                </section>

                <!-- SECTION: DASHBOARD -->
                <section id="tab-dashboard" class="tab-content space-y-8">
                    <div class="flex flex-col md:flex-row justify-between md:items-center gap-4">
                        <h2 class="text-4xl font-black text-slate-900 tracking-tight">Consent Matrix</h2>
                        <div class="flex items-center space-x-3">
                            <input type="text" id="hh-search" onkeyup="renderTable()" placeholder="Filter Registry..." class="bg-white border p-3 rounded-xl text-xs font-bold w-48 shadow-sm">
                            <button onclick="openModal('modal-hh')" class="bg-slate-900 text-white p-3 rounded-xl hover:bg-slate-800 transition-all">
                                <i class="fas fa-plus px-2"></i>
                            </button>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="bg-emerald-600 p-8 rounded-[2rem] text-white shadow-xl shadow-emerald-100 relative overflow-hidden">
                            <i class="fas fa-check-circle absolute -right-4 -bottom-4 text-8xl opacity-10"></i>
                            <p class="text-[10px] font-black uppercase tracking-widest opacity-80">Full Consent</p>
                            <h4 class="text-5xl font-black mt-2" id="stat-yes">0</h4>
                        </div>
                        <div class="bg-white p-8 rounded-[2rem] border border-slate-200 shadow-sm relative overflow-hidden">
                            <p class="text-[10px] font-black text-slate-400 uppercase tracking-widest">In Negotiation</p>
                            <h4 class="text-5xl font-black mt-2 text-slate-800" id="stat-pending">0</h4>
                        </div>
                        <div class="bg-white p-8 rounded-[2rem] border border-slate-200 shadow-sm relative overflow-hidden">
                            <p class="text-[10px] font-black text-rose-400 uppercase tracking-widest">Withdrawn</p>
                            <h4 class="text-5xl font-black mt-2 text-rose-600" id="stat-no">0</h4>
                        </div>
                    </div>

                    <div class="bg-white rounded-[2rem] border border-slate-200 overflow-hidden shadow-sm">
                        <table class="w-full text-left">
                            <thead class="bg-slate-50/50">
                                <tr>
                                    <th class="p-6 text-[10px] font-black text-slate-400 uppercase tracking-widest">Household ID</th>
                                    <th class="p-6 text-[10px] font-black text-slate-400 uppercase tracking-widest">Validation Status</th>
                                    <th class="p-6 text-[10px] font-black text-slate-400 uppercase tracking-widest">Last Updated</th>
                                    <th class="p-6 text-[10px] font-black text-slate-400 uppercase tracking-widest text-right">Cycle</th>
                                </tr>
                            </thead>
                            <tbody id="hh-body" class="divide-y divide-slate-100">
                                <!-- Rendered via JS -->
                            </tbody>
                        </table>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <!-- MODAL: SITE SETUP -->
    <div id="modal-profile" class="modal">
        <div class="bg-white w-full max-w-md rounded-[2.5rem] p-10 shadow-2xl">
            <h3 class="text-2xl font-black text-slate-900 mb-6">Site Baseline Setup</h3>
            <div class="space-y-4">
                <div>
                    <label class="text-[10px] font-black text-slate-400 uppercase ml-2 mb-1 block">Project Region</label>
                    <select id="in-region" class="form-input font-bold">
                        <option value="Region 10 (Northern Mindanao)">Region 10</option>
                        <option value="Region 11 (Davao Region)">Region 11</option>
                        <option value="Region 12 (SOCCSKSARGEN)">Region 12</option>
                    </select>
                </div>
                <div>
                    <label class="text-[10px] font-black text-slate-400 uppercase ml-2 mb-1 block">Barangay Name</label>
                    <input type="text" id="in-barangay" placeholder="e.g. Talayan" class="form-input font-bold">
                </div>
                <div>
                    <label class="text-[10px] font-black text-slate-400 uppercase ml-2 mb-1 block">IP Tribe/Group</label>
                    <input type="text" id="in-ip" placeholder="e.g. Teduray" class="form-input font-bold">
                </div>
                <div>
                    <label class="text-[10px] font-black text-slate-400 uppercase ml-2 mb-1 block">CADT Identification</label>
                    <input type="text" id="in-cadt" placeholder="NCIP-CADT-XX-XXXX" class="form-input font-bold">
                </div>
                <div class="pt-4 flex space-x-3">
                    <button onclick="closeModal('modal-profile')" class="flex-1 py-4 text-sm font-bold text-slate-400">Cancel</button>
                    <button onclick="saveProfile()" class="flex-1 py-4 bg-emerald-600 text-white rounded-2xl text-sm font-black shadow-lg">Save Site</button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL: NEW SESSION -->
    <div id="modal-session" class="modal">
        <div class="bg-white w-full max-w-lg rounded-[2.5rem] p-10 shadow-2xl">
            <h3 class="text-2xl font-black text-slate-900 mb-2">Log Assembly</h3>
            <p class="text-xs text-slate-400 font-bold uppercase mb-8">Annex 8 Compliance</p>
            <div class="grid grid-cols-2 gap-4">
                <div class="col-span-2">
                    <label class="text-[10px] font-black text-slate-400 uppercase ml-2 mb-1 block">FPIC Stage</label>
                    <select id="in-stage" class="form-input font-bold">
                        <option>Social Preparation</option>
                        <option>First Community Assembly</option>
                        <option>Information Disclosure (ESIA Findings)</option>
                        <option>Consensus Building</option>
                        <option>Decision Making / MOA Signing</option>
                    </select>
                </div>
                <div>
                    <label class="text-[10px] font-black text-slate-400 uppercase ml-2 mb-1 block">Date of Meeting</label>
                    <input type="date" id="in-date" class="form-input font-bold">
                </div>
                <div>
                    <label class="text-[10px] font-black text-slate-400 uppercase ml-2 mb-1 block">Facilitator</label>
                    <input type="text" id="in-facilitator" placeholder="Name" class="form-input font-bold">
                </div>
                <div>
                    <label class="text-[10px] font-black text-slate-400 uppercase ml-2 mb-1 block text-pink-600">Women (Signed)</label>
                    <input type="number" id="in-women" placeholder="0" class="form-input font-bold">
                </div>
                <div>
                    <label class="text-[10px] font-black text-slate-400 uppercase ml-2 mb-1 block text-blue-600">Men (Signed)</label>
                    <input type="number" id="in-men" placeholder="0" class="form-input font-bold">
                </div>
                <div class="col-span-2 pt-4 flex space-x-3">
                    <button onclick="closeModal('modal-session')" class="flex-1 py-4 text-sm font-bold text-slate-400">Discard</button>
                    <button onclick="saveSession()" class="flex-1 py-4 bg-slate-900 text-white rounded-2xl text-sm font-black shadow-lg">Log Activity</button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL: NEW HOUSEHOLD -->
    <div id="modal-hh" class="modal">
        <div class="bg-white w-full max-w-sm rounded-[2.5rem] p-10 shadow-2xl">
            <h3 class="text-2xl font-black text-slate-900 mb-6">Register Household</h3>
            <div class="space-y-4">
                <div>
                    <label class="text-[10px] font-black text-slate-400 uppercase ml-2 mb-1 block">HH Local ID</label>
                    <input type="text" id="in-hhid" placeholder="e.g. HH-01-A" class="form-input font-bold uppercase">
                </div>
                <div>
                    <label class="text-[10px] font-black text-slate-400 uppercase ml-2 mb-1 block">Initial Status</label>
                    <select id="in-hhstatus" class="form-input font-bold">
                        <option value="Pending">In Review</option>
                        <option value="Yes">Consent Provided</option>
                        <option value="No">Withdrawn</option>
                    </select>
                </div>
                <div class="pt-4">
                    <button onclick="saveHH()" class="w-full py-4 bg-emerald-600 text-white rounded-2xl text-sm font-black shadow-lg">Register</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        /** * DATA REPOSITORY & PERSISTENCE
         */
        const STORE_KEY = "SAFEGUARD_PRO_V3";
        let state = {
            profile: { region: "", barangay: "", ipGroup: "", cadt: "", coords: "0.000°N, 0.000°E" },
            sessions: [],
            households: []
        };

        function load() {
            const data = localStorage.getItem(STORE_KEY);
            if (data) state = JSON.parse(data);
            render();
        }

        function save() {
            localStorage.setItem(STORE_KEY, JSON.stringify(state));
            render();
        }

        /** * CORE ACTIONS
         */
        function openModal(id) { document.getElementById(id).classList.add('active'); }
        function closeModal(id) { document.getElementById(id).classList.remove('active'); }

        function saveProfile() {
            state.profile.region = document.getElementById('in-region').value;
            state.profile.barangay = document.getElementById('in-barangay').value;
            state.profile.ipGroup = document.getElementById('in-ip').value;
            state.profile.cadt = document.getElementById('in-cadt').value;
            save();
            closeModal('modal-profile');
        }

        function saveSession() {
            const women = parseInt(document.getElementById('in-women').value) || 0;
            const men = parseInt(document.getElementById('in-men').value) || 0;
            const session = {
                id: Date.now(),
                stage: document.getElementById('in-stage').value,
                date: document.getElementById('in-date').value || new Date().toISOString().split('T')[0],
                facilitator: document.getElementById('in-facilitator').value || "Project Officer",
                stats: { women, men, total: women + men }
            };
            state.sessions.unshift(session);
            save();
            closeModal('modal-session');
        }

        function saveHH() {
            const id = document.getElementById('in-hhid').value.trim();
            if (!id) return;
            state.households.unshift({
                id: id.toUpperCase(),
                status: document.getElementById('in-hhstatus').value,
                updated: new Date().toLocaleDateString()
            });
            document.getElementById('in-hhid').value = "";
            save();
            closeModal('modal-hh');
        }

        function cycleStatus(id) {
            const hh = state.households.find(h => h.id === id);
            const cycle = ['Pending', 'Yes', 'No'];
            hh.status = cycle[(cycle.indexOf(hh.status) + 1) % cycle.length];
            hh.updated = new Date().toLocaleDateString();
            save();
        }

        function getGPS() {
            const el = document.getElementById('val-coords');
            el.innerText = "Sourcing...";
            if ("geolocation" in navigator) {
                navigator.geolocation.getCurrentPosition(pos => {
                    state.profile.coords = `${pos.coords.latitude.toFixed(4)}°N, ${pos.coords.longitude.toFixed(4)}°E`;
                    save();
                }, () => { el.innerText = "Denied"; });
            }
        }

        /** * RENDERING
         */
        function switchTab(id) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.getElementById('tab-' + id).classList.add('active');
            
            document.querySelectorAll('nav button').forEach(el => {
                el.className = "flex items-center space-x-3 w-full p-4 rounded-2xl text-slate-500 hover:bg-slate-50 transition-all";
            });
            document.getElementById('btn-' + id).className = "nav-active flex items-center space-x-3 w-full p-4 rounded-2xl transition-all";
        }

        function render() {
            // Profile Data
            document.getElementById('val-region').innerText = state.profile.region || "Not Set";
            document.getElementById('val-barangay').innerText = state.profile.barangay || "Not Set";
            document.getElementById('val-ip').innerText = state.profile.ipGroup || "Not Set";
            document.getElementById('val-cadt').innerText = state.profile.cadt || "NCIP-CADT-PENDING";
            document.getElementById('val-coords').innerText = state.profile.coords;

            // Stats
            document.getElementById('stat-yes').innerText = state.households.filter(h => h.status === 'Yes').length;
            document.getElementById('stat-pending').innerText = state.households.filter(h => h.status === 'Pending').length;
            document.getElementById('stat-no').innerText = state.households.filter(h => h.status === 'No').length;

            // Sessions
            const grid = document.getElementById('session-grid');
            if (state.sessions.length === 0) {
                grid.innerHTML = `<div class="col-span-2 py-12 text-center text-slate-400 font-bold border-2 border-dashed rounded-3xl">No assemblies logged yet.</div>`;
            } else {
                grid.innerHTML = state.sessions.map(s => `
                    <div class="bg-white p-8 rounded-[2.5rem] border border-slate-200 shadow-sm relative group overflow-hidden">
                        <div class="flex justify-between items-start mb-6">
                            <span class="text-[10px] font-black bg-slate-100 text-slate-500 px-3 py-1 rounded-full uppercase tracking-tighter">${s.stage.slice(0, 15)}...</span>
                            <p class="text-[10px] font-black text-slate-300 uppercase">${s.date}</p>
                        </div>
                        <h4 class="text-xl font-black text-slate-800 leading-tight">${s.stage}</h4>
                        <p class="text-xs font-bold text-slate-400 mt-2">Lead: ${s.facilitator}</p>
                        <div class="mt-8 pt-6 border-t border-slate-50 flex items-center justify-between">
                            <div class="flex -space-x-2">
                                <div class="h-8 w-8 rounded-full bg-pink-100 border-2 border-white flex items-center justify-center text-[10px] font-bold text-pink-600">${s.stats.women}W</div>
                                <div class="h-8 w-8 rounded-full bg-blue-100 border-2 border-white flex items-center justify-center text-[10px] font-bold text-blue-600">${s.stats.men}M</div>
                            </div>
                            <span class="text-[10px] font-black text-slate-800 uppercase">Total Participation: ${s.stats.total}</span>
                        </div>
                    </div>
                `).join('');
            }

            renderTable();
        }

        function renderTable() {
            const query = document.getElementById('hh-search').value.toLowerCase();
            const filtered = state.households.filter(h => h.id.includes(query.toUpperCase()));
            const body = document.getElementById('hh-body');
            
            body.innerHTML = filtered.map(h => {
                const colors = h.status === 'Yes' ? 'bg-emerald-50 text-emerald-600 border-emerald-100' : (h.status === 'No' ? 'bg-rose-50 text-rose-600 border-rose-100' : 'bg-amber-50 text-amber-600 border-amber-100');
                return `
                    <tr class="hover:bg-slate-50/30 transition-colors">
                        <td class="p-6 font-mono text-xs font-black text-slate-500">${h.id}</td>
                        <td class="p-6">
                            <span class="status-pill ${colors}">${h.status}</span>
                        </td>
                        <td class="p-6 text-[10px] font-bold text-slate-400 uppercase">${h.updated}</td>
                        <td class="p-6 text-right">
                            <button onclick="cycleStatus('${h.id}')" class="p-2 text-slate-300 hover:text-emerald-600"><i class="fas fa-rotate"></i></button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function simulateSync() {
            const btn = event.target;
            const originalText = btn.innerText;
            btn.innerText = "UPLOADING...";
            btn.disabled = true;
            setTimeout(() => {
                btn.innerText = "SYNC COMPLETE";
                setTimeout(() => {
                    btn.innerText = originalText;
                    btn.disabled = false;
                }, 2000);
            }, 1500);
        }

        load();
    </script>
</body>
</html>
