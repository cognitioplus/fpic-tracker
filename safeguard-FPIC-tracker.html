<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Safeguard+ FPIC Tracker | UNIDO</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .modal { display: none; position: fixed; inset: 0; background: rgba(15, 23, 42, 0.7); z-index: 200; align-items: center; justify-content: center; backdrop-filter: blur(4px); padding: 1rem; }
        .modal.active { display: flex; }
        .form-input { width: 100%; padding: 0.875rem; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 0.75rem; font-size: 0.875rem; transition: all 0.2s; }
        .form-input:focus { outline: none; border-color: #10b981; box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1); background: white; }
        .nav-active { background: #10b981 !important; color: white !important; box-shadow: 0 10px 15px -3px rgba(16, 185, 129, 0.2); }
        .status-pill { font-size: 0.65rem; font-weight: 800; text-transform: uppercase; padding: 0.25rem 0.75rem; border-radius: 9999px; border-width: 1px; }
        
        /* Mobile Sidebar Transitions */
        #mobile-sidebar { transform: translateX(-100%); transition: transform 0.3s ease-in-out; }
        #mobile-sidebar.open { transform: translateX(0); }
        #mobile-overlay { opacity: 0; pointer-events: none; transition: opacity 0.3s ease-in-out; }
        #mobile-overlay.open { opacity: 1; pointer-events: auto; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 h-screen overflow-hidden">

    <!-- Mobile Overlay -->
    <div id="mobile-overlay" onclick="toggleMobileMenu()" class="fixed inset-0 bg-slate-900/60 z-[60]"></div>

    <!-- Mobile Sidebar Drawer -->
    <aside id="mobile-sidebar" class="fixed top-0 left-0 bottom-0 w-80 bg-white z-[70] p-6 shadow-2xl lg:hidden">
        <div class="flex justify-between items-center mb-10">
            <div class="flex items-center space-x-3">
                <div class="bg-emerald-600 p-2 rounded-xl"><i class="fas fa-leaf text-white"></i></div>
                <h1 class="font-black text-slate-800">Safeguard+ FPIC</h1>
            </div>
            <button onclick="toggleMobileMenu()" class="text-slate-400 p-2"><i class="fas fa-times text-xl"></i></button>
        </div>
        <nav class="space-y-2" id="mobile-nav-list">
            <!-- Nav buttons mirrored here via JS or static -->
        </nav>
    </aside>

    <div class="flex h-screen">
        <!-- Desktop Sidebar -->
        <aside class="hidden lg:flex flex-col w-72 bg-white border-r border-slate-200 p-6">
            <div class="flex items-center space-x-3 mb-10">
                <div class="bg-emerald-600 p-2 rounded-xl shadow-lg"><i class="fas fa-leaf text-white text-xl"></i></div>
                <div>
                    <h1 class="text-xl font-black text-slate-800 tracking-tighter leading-none">Safeguard+</h1>
                    <p class="text-[9px] font-bold text-slate-400 uppercase tracking-widest mt-1">FPIC Tracker</p>
                </div>
            </div>
            
            <nav class="space-y-2 flex-1" id="desktop-nav-list">
                <!-- Nav buttons added here -->
            </nav>

            <div class="pt-6 border-t border-slate-100">
                <div class="bg-slate-900 text-white p-4 rounded-2xl">
                    <p class="text-[10px] font-bold text-slate-400 mb-1">UNIDO SAP ID 240307</p>
                    <button onclick="simulateSync()" class="w-full py-2.5 bg-emerald-600 rounded-xl text-xs font-bold hover:bg-emerald-500 transition-colors">CLOUD PUSH</button>
                </div>
            </div>
        </aside>

        <!-- Main Workspace -->
        <main class="flex-1 overflow-y-auto custom-scrollbar">
            <!-- Mobile Header -->
            <div class="lg:hidden bg-white border-b p-4 flex justify-between items-center sticky top-0 z-50">
                <div class="flex items-center space-x-2">
                    <button onclick="toggleMobileMenu()" class="p-2 text-slate-500 bg-slate-50 rounded-lg"><i class="fas fa-bars"></i></button>
                    <h1 class="font-black text-slate-800 text-sm">Safeguard+ FPIC Tracker</h1>
                </div>
                <div class="h-2 w-2 rounded-full bg-emerald-500 animate-pulse"></div>
            </div>

            <div class="max-w-6xl mx-auto p-6 md:p-12">
                
                <!-- SECTION: PROFILE -->
                <section id="tab-profile" class="tab-content active space-y-8">
                    <div class="flex flex-col md:flex-row justify-between md:items-end gap-4">
                        <div>
                            <h2 class="text-3xl md:text-4xl font-black text-slate-900 tracking-tight">Site Baseline</h2>
                            <p class="text-slate-500 mt-2 font-medium">Define community boundaries & IP demographics.</p>
                        </div>
                        <button onclick="openModal('modal-profile')" class="bg-white border border-slate-200 px-5 py-3 rounded-2xl font-bold text-sm hover:shadow-lg transition-all flex items-center justify-center">
                            <i class="fas fa-pen-to-square mr-2 text-emerald-600"></i>Configure Site
                        </button>
                    </div>

                    <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6">
                        <div class="bg-white p-5 md:p-6 rounded-3xl border border-slate-200 shadow-sm">
                            <span class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Region</span>
                            <p class="text-sm md:text-lg font-bold text-slate-800 mt-1 truncate" id="val-region">-</p>
                        </div>
                        <div class="bg-white p-5 md:p-6 rounded-3xl border border-slate-200 shadow-sm">
                            <span class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Barangay</span>
                            <p class="text-sm md:text-lg font-bold text-slate-800 mt-1 truncate" id="val-barangay">-</p>
                        </div>
                        <div class="bg-white p-5 md:p-6 rounded-3xl border border-slate-200 shadow-sm">
                            <span class="text-[10px] font-black text-slate-400 uppercase tracking-widest">IP Group</span>
                            <p class="text-sm md:text-lg font-bold text-slate-800 mt-1 truncate" id="val-ip">-</p>
                        </div>
                        <div class="bg-white p-5 md:p-6 rounded-3xl border border-slate-200 shadow-sm">
                            <span class="text-[10px] font-black text-slate-400 uppercase tracking-widest">CADT Ref</span>
                            <p class="text-sm md:text-lg font-bold text-slate-800 mt-1 truncate" id="val-cadt">-</p>
                        </div>
                    </div>

                    <div class="bg-white rounded-[2rem] border border-slate-200 overflow-hidden shadow-sm">
                        <div class="p-6 md:p-8 border-b border-slate-50 flex justify-between items-center">
                            <h3 class="font-bold text-slate-800 flex items-center">
                                <i class="fas fa-location-dot mr-3 text-emerald-500"></i>Site Coordinates
                            </h3>
                            <button onclick="getGPS()" class="text-[10px] font-black text-emerald-600 bg-emerald-50 px-4 py-2 rounded-xl hover:bg-emerald-100 transition-all uppercase tracking-widest">Ping GPS</button>
                        </div>
                        <div class="p-6 md:p-8">
                            <div class="bg-slate-50 p-6 rounded-2xl flex flex-col md:flex-row md:items-center justify-between gap-4">
                                <div class="flex items-center space-x-4">
                                    <div class="h-12 w-12 bg-white rounded-xl flex items-center justify-center text-emerald-600 shadow-sm">
                                        <i class="fas fa-satellite"></i>
                                    </div>
                                    <div>
                                        <p class="text-[10px] font-black text-slate-400 uppercase">Live Telemetry</p>
                                        <p class="font-mono text-sm font-bold text-slate-700" id="val-coords">Pending Access</p>
                                    </div>
                                </div>
                                <p class="text-[10px] font-bold text-slate-400 max-w-xs md:text-right">Required for ESIA Annex compliance in Mindanao cluster project areas.</p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- SECTION: SESSIONS -->
                <section id="tab-sessions" class="tab-content space-y-8">
                    <div class="flex flex-col md:flex-row justify-between md:items-end gap-4">
                        <div>
                            <h2 class="text-3xl md:text-4xl font-black text-slate-900 tracking-tight">Engagement Logs</h2>
                            <p class="text-slate-500 mt-2 font-medium">Record of stakeholder consultations & assemblies.</p>
                        </div>
                        <button onclick="openModal('modal-session')" class="bg-emerald-600 text-white px-6 py-4 rounded-[1.25rem] font-bold shadow-lg shadow-emerald-100 hover:scale-105 transition-all flex items-center justify-center">
                            <i class="fas fa-plus mr-2"></i>New Assembly
                        </button>
                    </div>

                    <div id="session-grid" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Rendered via JS -->
                    </div>
                </section>

                <!-- SECTION: DASHBOARD -->
                <section id="tab-dashboard" class="tab-content space-y-8">
                    <div class="flex flex-col md:flex-row justify-between md:items-center gap-4">
                        <h2 class="text-3xl md:text-4xl font-black text-slate-900 tracking-tight">Consent Matrix</h2>
                        <div class="flex items-center space-x-3 w-full md:w-auto">
                            <div class="relative flex-1">
                                <i class="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-slate-300"></i>
                                <input type="text" id="hh-search" onkeyup="renderTable()" placeholder="Search ID..." class="bg-white border p-3 pl-10 rounded-xl text-xs font-bold w-full shadow-sm">
                            </div>
                            <button onclick="openModal('modal-hh')" class="bg-slate-900 text-white p-3.5 rounded-xl hover:bg-slate-800 transition-all shadow-lg">
                                <i class="fas fa-user-plus px-1"></i>
                            </button>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="bg-emerald-600 p-8 rounded-[2.5rem] text-white shadow-xl shadow-emerald-100 relative overflow-hidden group">
                            <i class="fas fa-check-circle absolute -right-4 -bottom-4 text-8xl opacity-10 group-hover:scale-110 transition-transform"></i>
                            <p class="text-[10px] font-black uppercase tracking-widest opacity-80">Full Consent</p>
                            <h4 class="text-5xl font-black mt-2" id="stat-yes">0</h4>
                        </div>
                        <div class="bg-white p-8 rounded-[2.5rem] border border-slate-200 shadow-sm relative overflow-hidden">
                            <p class="text-[10px] font-black text-slate-400 uppercase tracking-widest">In Negotiation</p>
                            <h4 class="text-5xl font-black mt-2 text-slate-800" id="stat-pending">0</h4>
                        </div>
                        <div class="bg-white p-8 rounded-[2.5rem] border border-slate-200 shadow-sm relative overflow-hidden">
                            <p class="text-[10px] font-black text-rose-400 uppercase tracking-widest">Withdrawn</p>
                            <h4 class="text-5xl font-black mt-2 text-rose-600" id="stat-no">0</h4>
                        </div>
                    </div>

                    <div class="bg-white rounded-[2rem] border border-slate-200 overflow-hidden shadow-sm overflow-x-auto">
                        <table class="w-full text-left min-w-[600px]">
                            <thead class="bg-slate-50/50">
                                <tr>
                                    <th class="p-6 text-[10px] font-black text-slate-400 uppercase tracking-widest">Household ID</th>
                                    <th class="p-6 text-[10px] font-black text-slate-400 uppercase tracking-widest">Validation Status</th>
                                    <th class="p-6 text-[10px] font-black text-slate-400 uppercase tracking-widest">Date Logged</th>
                                    <th class="p-6 text-[10px] font-black text-slate-400 uppercase tracking-widest text-right">Toggle</th>
                                </tr>
                            </thead>
                            <tbody id="hh-body" class="divide-y divide-slate-100">
                                <!-- Rendered via JS -->
                            </tbody>
                        </table>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <!-- MODAL: SITE SETUP -->
    <div id="modal-profile" class="modal">
        <div class="bg-white w-full max-w-md rounded-[2.5rem] p-10 shadow-2xl">
            <h3 class="text-2xl font-black text-slate-900 mb-6">Site Configuration</h3>
            <div class="space-y-4">
                <div>
                    <label class="text-[10px] font-black text-slate-400 uppercase ml-2 mb-1 block">Project Region</label>
                    <select id="in-region" class="form-input font-bold">
                        <option value="Region 10 (Northern Mindanao)">Region 10</option>
                        <option value="Region 11 (Davao Region)">Region 11</option>
                        <option value="Region 12 (SOCCSKSARGEN)">Region 12</option>
                    </select>
                </div>
                <div>
                    <label class="text-[10px] font-black text-slate-400 uppercase ml-2 mb-1 block">Barangay Name</label>
                    <input type="text" id="in-barangay" placeholder="e.g. Talayan" class="form-input font-bold">
                </div>
                <div>
                    <label class="text-[10px] font-black text-slate-400 uppercase ml-2 mb-1 block">IP Tribe/Group</label>
                    <input type="text" id="in-ip" placeholder="e.g. Teduray" class="form-input font-bold">
                </div>
                <div>
                    <label class="text-[10px] font-black text-slate-400 uppercase ml-2 mb-1 block">CADT Ref</label>
                    <input type="text" id="in-cadt" placeholder="NCIP-CADT-XX-XXXX" class="form-input font-bold">
                </div>
                <div class="pt-4 flex space-x-3">
                    <button onclick="closeModal('modal-profile')" class="flex-1 py-4 text-sm font-bold text-slate-400">Cancel</button>
                    <button onclick="saveProfile()" class="flex-1 py-4 bg-emerald-600 text-white rounded-2xl text-sm font-black shadow-lg">Commit</button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL: NEW SESSION -->
    <div id="modal-session" class="modal">
        <div class="bg-white w-full max-w-lg rounded-[2.5rem] p-8 md:p-10 shadow-2xl max-h-[90vh] overflow-y-auto custom-scrollbar">
            <h3 class="text-2xl font-black text-slate-900 mb-1">Log Assembly</h3>
            <p class="text-[10px] text-slate-400 font-bold uppercase mb-8">Annex 8 | Stakeholder Engagement</p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="md:col-span-2">
                    <label class="text-[10px] font-black text-slate-400 uppercase ml-2 mb-1 block">FPIC Stage</label>
                    <select id="in-stage" class="form-input font-bold">
                        <option>Social Preparation</option>
                        <option>First Community Assembly</option>
                        <option>Information Disclosure</option>
                        <option>Consensus Building</option>
                        <option>Decision Making / MOA Signing</option>
                    </select>
                </div>
                <div>
                    <label class="text-[10px] font-black text-slate-400 uppercase ml-2 mb-1 block">Meeting Date</label>
                    <input type="date" id="in-date" class="form-input font-bold">
                </div>
                <div>
                    <label class="text-[10px] font-black text-slate-400 uppercase ml-2 mb-1 block">Lead Facilitator</label>
                    <input type="text" id="in-facilitator" placeholder="Name" class="form-input font-bold">
                </div>
                <div>
                    <label class="text-[10px] font-black text-pink-500 uppercase ml-2 mb-1 block">Women Participants</label>
                    <input type="number" id="in-women" placeholder="0" class="form-input font-bold">
                </div>
                <div>
                    <label class="text-[10px] font-black text-blue-500 uppercase ml-2 mb-1 block">Men Participants</label>
                    <input type="number" id="in-men" placeholder="0" class="form-input font-bold">
                </div>
                <div class="md:col-span-2 pt-4 flex space-x-3">
                    <button onclick="closeModal('modal-session')" class="flex-1 py-4 text-sm font-bold text-slate-400">Discard</button>
                    <button onclick="saveSession()" class="flex-1 py-4 bg-slate-900 text-white rounded-2xl text-sm font-black shadow-lg">Save Record</button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL: NEW HOUSEHOLD -->
    <div id="modal-hh" class="modal">
        <div class="bg-white w-full max-w-sm rounded-[2.5rem] p-10 shadow-2xl">
            <h3 class="text-2xl font-black text-slate-900 mb-6">Register Household</h3>
            <div class="space-y-4">
                <div>
                    <label class="text-[10px] font-black text-slate-400 uppercase ml-2 mb-1 block">Household ID</label>
                    <input type="text" id="in-hhid" placeholder="HH-XXX" class="form-input font-bold uppercase">
                </div>
                <div>
                    <label class="text-[10px] font-black text-slate-400 uppercase ml-2 mb-1 block">Initial Consent</label>
                    <select id="in-hhstatus" class="form-input font-bold">
                        <option value="Pending">Negotiating</option>
                        <option value="Yes">Granted</option>
                        <option value="No">Withdrawn</option>
                    </select>
                </div>
                <div class="pt-4">
                    <button onclick="saveHH()" class="w-full py-4 bg-emerald-600 text-white rounded-2xl text-sm font-black shadow-lg">Add to Registry</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        /** * APP STATE
         */
        const STORE_KEY = "SAFEGUARD_FPIC_TRACKER_DATA";
        let state = {
            profile: { region: "", barangay: "", ipGroup: "", cadt: "", coords: "Awaiting Sensor..." },
            sessions: [],
            households: []
        };

        const NAV_ITEMS = [
            { id: 'profile', icon: 'fas fa-map-marked-alt', label: 'Site Baseline' },
            { id: 'sessions', icon: 'fas fa-users-rectangle', label: 'Engagement Logs' },
            { id: 'dashboard', icon: 'fas fa-chart-line', label: 'Consent Matrix' }
        ];

        /** * CORE LOGIC
         */
        function load() {
            const data = localStorage.getItem(STORE_KEY);
            if (data) state = JSON.parse(data);
            initNav();
            render();
        }

        function save() {
            localStorage.setItem(STORE_KEY, JSON.stringify(state));
            render();
        }

        function initNav() {
            const desktopNav = document.getElementById('desktop-nav-list');
            const mobileNav = document.getElementById('mobile-nav-list');
            
            const html = NAV_ITEMS.map(item => `
                <button onclick="switchTab('${item.id}')" id="nav-${item.id}" class="flex items-center space-x-3 w-full p-4 rounded-2xl text-slate-500 hover:bg-slate-50 transition-all font-bold">
                    <i class="${item.icon} w-5"></i><span>${item.label}</span>
                </button>
            `).join('');
            
            desktopNav.innerHTML = html;
            mobileNav.innerHTML = html;
            updateNavUI('profile');
        }

        function toggleMobileMenu() {
            const sidebar = document.getElementById('mobile-sidebar');
            const overlay = document.getElementById('mobile-overlay');
            sidebar.classList.toggle('open');
            overlay.classList.toggle('open');
        }

        function switchTab(id) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.getElementById('tab-' + id).classList.add('active');
            updateNavUI(id);
            if (document.getElementById('mobile-sidebar').classList.contains('open')) {
                toggleMobileMenu();
            }
        }

        function updateNavUI(activeId) {
            document.querySelectorAll('nav button').forEach(el => {
                el.classList.remove('nav-active');
                if (el.id.includes(activeId)) el.classList.add('nav-active');
            });
        }

        function openModal(id) { document.getElementById(id).classList.add('active'); }
        function closeModal(id) { document.getElementById(id).classList.remove('active'); }

        /** * CRUD OPERATIONS
         */
        function saveProfile() {
            state.profile.region = document.getElementById('in-region').value;
            state.profile.barangay = document.getElementById('in-barangay').value;
            state.profile.ipGroup = document.getElementById('in-ip').value;
            state.profile.cadt = document.getElementById('in-cadt').value;
            save();
            closeModal('modal-profile');
        }

        function saveSession() {
            const w = parseInt(document.getElementById('in-women').value) || 0;
            const m = parseInt(document.getElementById('in-men').value) || 0;
            state.sessions.unshift({
                id: Date.now(),
                stage: document.getElementById('in-stage').value,
                date: document.getElementById('in-date').value || "2024-01-01",
                facilitator: document.getElementById('in-facilitator').value || "Field Officer",
                stats: { w, m, total: w + m }
            });
            save();
            closeModal('modal-session');
        }

        function saveHH() {
            const id = document.getElementById('in-hhid').value.trim();
            if (!id) return;
            state.households.unshift({
                id: id.toUpperCase(),
                status: document.getElementById('in-hhstatus').value,
                date: new Date().toLocaleDateString()
            });
            document.getElementById('in-hhid').value = "";
            save();
            closeModal('modal-hh');
        }

        function toggleHH(id) {
            const hh = state.households.find(h => h.id === id);
            const cycle = ['Pending', 'Yes', 'No'];
            hh.status = cycle[(cycle.indexOf(hh.status) + 1) % cycle.length];
            save();
        }

        function getGPS() {
            const el = document.getElementById('val-coords');
            el.innerText = "Syncing...";
            if ("geolocation" in navigator) {
                navigator.geolocation.getCurrentPosition(pos => {
                    state.profile.coords = `${pos.coords.latitude.toFixed(4)}°N, ${pos.coords.longitude.toFixed(4)}°E`;
                    save();
                }, () => { el.innerText = "Access Denied"; });
            }
        }

        /** * RENDER ENGINE
         */
        function render() {
            // Profile
            document.getElementById('val-region').innerText = state.profile.region || "Select Region";
            document.getElementById('val-barangay').innerText = state.profile.barangay || "Enter Name";
            document.getElementById('val-ip').innerText = state.profile.ipGroup || "Enter Group";
            document.getElementById('val-cadt').innerText = state.profile.cadt || "Reference Required";
            document.getElementById('val-coords').innerText = state.profile.coords;

            // Stats
            document.getElementById('stat-yes').innerText = state.households.filter(h => h.status === 'Yes').length;
            document.getElementById('stat-pending').innerText = state.households.filter(h => h.status === 'Pending').length;
            document.getElementById('stat-no').innerText = state.households.filter(h => h.status === 'No').length;

            // Sessions
            const sGrid = document.getElementById('session-grid');
            if (state.sessions.length === 0) {
                sGrid.innerHTML = `<div class="col-span-full py-16 text-center text-slate-400 font-bold border-2 border-dashed border-slate-200 rounded-[2.5rem]">No engagement logs recorded.</div>`;
            } else {
                sGrid.innerHTML = state.sessions.map(s => `
                    <div class="bg-white p-8 rounded-[2.5rem] border border-slate-200 shadow-sm hover:shadow-md transition-all">
                        <div class="flex justify-between items-start mb-6">
                            <span class="text-[9px] font-black bg-emerald-50 text-emerald-600 px-3 py-1 rounded-lg uppercase">${s.date}</span>
                            <div class="flex -space-x-2">
                                <div class="h-8 w-8 rounded-full bg-pink-100 border-2 border-white flex items-center justify-center text-[10px] font-bold text-pink-500">${s.stats.w}</div>
                                <div class="h-8 w-8 rounded-full bg-blue-100 border-2 border-white flex items-center justify-center text-[10px] font-bold text-blue-500">${s.stats.m}</div>
                            </div>
                        </div>
                        <h4 class="text-xl font-black text-slate-800 leading-tight mb-2">${s.stage}</h4>
                        <p class="text-[10px] font-bold text-slate-400 uppercase">Facilitated by ${s.facilitator}</p>
                        <div class="mt-8 pt-6 border-t border-slate-50 flex justify-between items-center">
                            <span class="text-[10px] font-black text-slate-800">Total Pax: ${s.stats.total}</span>
                            <i class="fas fa-chevron-right text-slate-200"></i>
                        </div>
                    </div>
                `).join('');
            }

            renderTable();
        }

        function renderTable() {
            const query = document.getElementById('hh-search').value.toLowerCase();
            const filtered = state.households.filter(h => h.id.includes(query.toUpperCase()));
            const tbody = document.getElementById('hh-body');
            
            tbody.innerHTML = filtered.map(h => {
                const colorMap = { 'Yes': 'bg-emerald-50 text-emerald-600 border-emerald-100', 'No': 'bg-rose-50 text-rose-600 border-rose-100', 'Pending': 'bg-amber-50 text-amber-600 border-amber-100' };
                return `
                    <tr class="hover:bg-slate-50/50 transition-colors">
                        <td class="p-6 font-mono text-xs font-black text-slate-500">${h.id}</td>
                        <td class="p-6"><span class="status-pill ${colorMap[h.status]}">${h.status}</span></td>
                        <td class="p-6 text-[10px] font-bold text-slate-400 uppercase">${h.date}</td>
                        <td class="p-6 text-right">
                            <button onclick="toggleHH('${h.id}')" class="p-2.5 text-slate-300 hover:text-emerald-600 bg-slate-50 rounded-xl transition-all"><i class="fas fa-rotate"></i></button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function simulateSync() {
            const btn = event.target;
            btn.innerText = "ENCRYPTING...";
            btn.disabled = true;
            setTimeout(() => {
                btn.innerText = "PUSH SUCCESS";
                setTimeout(() => { btn.innerText = "CLOUD PUSH"; btn.disabled = false; }, 2000);
            }, 1500);
        }

        load();
    </script>
</body>
</html>
